pkgname=nocturne-ui
version=3.0.0.beta.1
revision=1
short_desc="A web application for nocturne-image and the Spotify Car Thing"
# TODO: is this right or should it be makedepends
# may get rid of curl and unzip after removing bun.sh/install
hostmakedepends="pnpm"
depends="nodejs nocturned"
maintainer="Nocturne Team <team@usenocturne.com>"
license="GPL-3.0-only"
homepage="https://github.com/usenocturne/nocturned"
#distfiles="https://github.com/usenocturne/nocturne-ui/archive/refs/tags/v${version/.b/-b}.tar.gz"
#checksum=""
distfiles="https://github.com/usenocturne/nocturne-ui/archive/ce53b5845552e8d2d4b4ae07480bb69f55f89d20.tar.gz"
checksum="54aeed509449436762b6c591cd7595395b7c0d43ec9c8a27a33d13995ce6351b"

do_configure() {
    #pnpm install --frozen-lockfile
    pnpm install
}

do_build() {
    pnpm run build
}

do_install() {
    # FIXME: check if these are the right paths
    # https://github.com/usenocturne/nocturne-ui/blob/2d77d1377e601764285e15e09b5731d5e9990209/flake.nix#L88

    # TODO: is vmkdir necessary here
    vmkdir usr/share/nocturne
    vcopy .next/standalone/ usr/share/nocturne/standalone
    vmkdir usr/share/nocturne/.next
    vcopy .next/static/ usr/share/nocturne/.next/static
    vcopy public/ usr/share/nocturne/public
    vcopy prodserver.js usr/share/nocturne/prodserver.js

    # TODO: certs, should be in settings

    vbin "${FILESDIR}/nocturne-ui.sh" nocturne-ui
    # TODO: make the actual service
    vsv $pkgname
}

post_install() {
    vlicense LICENSE
}

